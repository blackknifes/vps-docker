{"version":3,"file":"main.js","mappings":"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,0CAAkB;;AAE1C;AACA;AACA;AACA;;AAEA;AACA,yBAAyB;AACzB,0BAA0B;AAC1B,2BAA2B;AAC3B,4BAA4B;;AAE5B;AACA;AACA;AACA;AACA,WAAW,cAAc;AACzB,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;;AAEA,kBAAkB,oBAAoB;AACtC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,cAAc;AACzB,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,oBAAoB;AACtC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,cAAc;AACzB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,oBAAoB;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;ACrLA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;ACNA;AACA;AACA;;AAEA,CAAC,kBAAkB;EACf,IAAIC,EAAE,GAAGb,2DAAA,CAAY,mBAAZ,CAAT;EACA,MAAMa,EAAE,CAACgB,IAAH,EAAN;EAEA,MAAM/C,GAAG,GAAG,IAAIf,mDAAJ,EAAZ;EACA,IAAI+D,WAAW,GAAG,IAAIlB,oDAAJ,CAAgBC,EAAhB,CAAlB;EACA/B,GAAG,CAACG,GAAJ,CAAQ,WAAR,EAAqB,UAAU;IAAEjC,OAAF;IAAWC,QAAX;IAAqBe,MAArB;IAA6BC;EAA7B,CAAV,EAA+C;IAChE,OAAO6D,WAAW,CAAChB,QAAZ,CAAqB7C,IAArB,CAAP;EACH,CAFD;EAIAa,GAAG,CAACM,IAAJ,CAAS,QAAT,EAAmB,UAAU;IAAEpB;EAAF,CAAV,EAAsB;IACrC,OAAO8D,WAAW,CAACL,KAAZ,CAAkBzD,MAAlB,CAAP;EACH,CAFD;EAIA,MAAMc,GAAG,CAACU,MAAJ,CAAW,EAAX,CAAN;AACH,CAfD,I","sources":["webpack://x-manager-server/./src/ExpressApp.js","webpack://x-manager-server/./src/Result.js","webpack://x-manager-server/./src/UserService.js","webpack://x-manager-server/./node_modules/cookie-parser/index.js","webpack://x-manager-server/external commonjs \"cookie\"","webpack://x-manager-server/external commonjs \"cookie-signature\"","webpack://x-manager-server/external commonjs \"express\"","webpack://x-manager-server/external commonjs \"nedb-promises\"","webpack://x-manager-server/external node-commonjs \"crypto\"","webpack://x-manager-server/external node-commonjs \"process\"","webpack://x-manager-server/webpack/bootstrap","webpack://x-manager-server/webpack/runtime/compat get default export","webpack://x-manager-server/webpack/runtime/define property getters","webpack://x-manager-server/webpack/runtime/hasOwnProperty shorthand","webpack://x-manager-server/webpack/runtime/make namespace object","webpack://x-manager-server/./src/index.js"],"sourcesContent":["import express, { Express, Request, Response } from \"express\";\r\nimport Result from \"./Result\";\r\nimport process from \"process\";\r\nimport cookieParser from \"cookie-parser\";\r\n\r\nfunction makeSessoinId() {\r\n    let buf = Buffer.allocUnsafe(16);\r\n    buf.writeUInt32LE(process.pid % 4294967295, 0);\r\n    buf.writeDoubleLE(new Date().getTime(), 4);\r\n    buf.writeUInt32LE(parseInt(Math.random() * 4294967295), 12)\r\n    return buf.toString(\"hex\");\r\n}\r\n\r\n/**\r\n * @typedef {(this: ExpressApp, param: {request: Request, response: Response, params: any, body: any, session: {} })=>Result | void} HttpHandler\r\n */\r\n\r\n/**\r\n * \r\n * @this {ExpressApp}\r\n * @param {HttpHandler} cb\r\n * @param {Request} request\r\n * @param {Response} response\r\n */\r\nasync function callback(cb, request, response) {\r\n    let sessionId = request.cookies ? request.cookies.JSESSIONID : undefined;\r\n    let session;\r\n    let now = new Date().getTime();\r\n    if (sessionId) {\r\n        session = this.sessions[sessionId];\r\n        if (session) {\r\n            if (parseInt((now - session.lastAccessTime) / 1000) >= this.maxInactiveInterval) {\r\n                delete this.sessions[sessionId];\r\n                session = undefined;\r\n            }\r\n            else\r\n                session.lastAccessTime = new Date().getTime();\r\n        }\r\n    }\r\n    if (!session) {\r\n        sessionId = makeSessoinId();\r\n        session = this.sessions[sessionId] = {\r\n            id: sessionId,\r\n            lastAccessTime: now,\r\n            createdTime: now\r\n        };\r\n        response.cookie(\"JSESSIONID\", sessionId);\r\n    }\r\n\r\n    let result;\r\n    try {\r\n        ExpressApp.session = session;\r\n        ExpressApp.request = request;\r\n        ExpressApp.response = response;\r\n\r\n        result = cb({\r\n            request,\r\n            response,\r\n            session,\r\n            params: request.params ? request.params : {},\r\n            body: request.body ? request.body : {},\r\n            headers: request.headers\r\n        });\r\n        ExpressApp.session = null;\r\n        ExpressApp.request = null;\r\n        ExpressApp.response = null;\r\n        if (result instanceof Promise)\r\n            result = await result;\r\n    } catch (err) {\r\n        if (err instanceof Result)\r\n            result = err;\r\n        else\r\n            result = new Result({ httpCode: 500, message: \"未知错误\" });\r\n    }\r\n\r\n    if (result) {\r\n        if (result.stream) {\r\n            response.status(200);\r\n            result.stream.pipe(response);\r\n        }\r\n        else if (result.httpCode)\r\n            response.status(result.httpCode).send(result.message);\r\n        else\r\n            response.status(200).send(JSON.stringify(result));\r\n    }\r\n    else\r\n        response.sendStatus(200);\r\n}\r\n\r\nclass ExpressApp {\r\n    /**@type {Express} */\r\n    app;\r\n\r\n    /**@type {Object} */\r\n    sessions = {};\r\n\r\n    /**@type {number} */\r\n    maxInactiveInterval = 30 * 1000;\r\n\r\n    constructor() {\r\n        this.app = express();\r\n        this.app.use(cookieParser());\r\n    }\r\n\r\n    /**\r\n     * get请求\r\n     * @param {string} url \r\n     * @param {HttpHandler} cb \r\n     */\r\n    get(url, cb) {\r\n        this.app.get(url, callback.bind(this, cb));\r\n    }\r\n\r\n    /**\r\n     * post请求\r\n     * @param {string} url \r\n     * @param {HttpHandler} cb \r\n     */\r\n    post(url, cb) {\r\n        this.app.get(url, callback.bind(this, cb));\r\n    }\r\n\r\n    /**\r\n     * put请求\r\n     * @param {string} url \r\n     * @param {HttpHandler} cb \r\n     */\r\n    put(url, cb) {\r\n        this.app.put(url, callback.bind(this, cb));\r\n    }\r\n\r\n    /**\r\n     * delete请求\r\n     * @param {string} url \r\n     * @param {HttpHandler} cb \r\n     */\r\n    delete(url, cb) {\r\n        this.app.delete(url, callback.bind(this, cb));\r\n    }\r\n\r\n    /**\r\n     * options请求\r\n     * @param {string} url \r\n     * @param {HttpHandler} cb \r\n     */\r\n    options(url, cb) {\r\n        this.app.options(url, callback.bind(this, cb));\r\n    }\r\n\r\n    /**\r\n     * 开始监听\r\n     * @param {number} [port] 监听端口\r\n     */\r\n    async listen(port) {\r\n        return new Promise((resolve) => {\r\n            this.app.listen(port, () => {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n/**@type {Object} */\r\nExpressApp.session = null;\r\n/**@type {Request} */\r\nExpressApp.request = null;\r\n/**@type {Response} */\r\nExpressApp.response = null;\r\n\r\nexport default ExpressApp;","\r\n\r\nclass Result {\r\n    /**\r\n     * 构造结果\r\n     * @param {{code?: number, httpCode?: number, stream?: NodeJS.ReadableStream, message?: string, result?: any}} options \r\n     */\r\n    constructor(options) {\r\n        if (typeof options.httpCode !== \"undefined\") {\r\n            this.httpCode = options.httpCode;\r\n            this.message = options.message;\r\n        }\r\n        else if (!options.code || options.code == 0) {\r\n            this.ok = true;\r\n            this.code = 0;\r\n            this.result = options.result;\r\n            this.stream = options.stream;\r\n        }\r\n        else {\r\n            this.ok = false;\r\n            this.code = options.code;\r\n            this.message = options.message;\r\n        }\r\n    }\r\n\r\n    toJson() {\r\n        return JSON.stringify(this);\r\n    }\r\n}\r\n\r\n/**\r\n * 成功回调\r\n * @param {any} result \r\n * @returns \r\n */\r\nResult.ok = function (result) {\r\n    return new Result({ result });\r\n};\r\n\r\n/**\r\n * 失败回调\r\n * @param {number} [code] \r\n * @param {string} [message] \r\n */\r\nResult.fail = function (code, message) {\r\n    if (typeof code == \"number\")\r\n        return new Result({ code, message });\r\n    else if (typeof code === \"string\")\r\n        return new Result({ code: -1000, message: code });\r\n    return new Result({ code: -1000, message: \"未知错误\" });\r\n}\r\n\r\n/**\r\n * 返回403错误\r\n * @param {string} message \r\n * @returns \r\n */\r\nResult.forbid = function (message) {\r\n    return new Result({ httpCode: 403, message });\r\n}\r\nexport default Result;","import nedb from \"nedb-promises\";\r\nimport crypto from \"crypto\";\r\nimport ExpressApp from \"./ExpressApp\";\r\nimport Result from \"./Result\";\r\n\r\nfunction sha256(value) {\r\n    let digest = crypto.createHash(\"sha256\");\r\n    return digest.update(value).digest().toString(\"hex\");\r\n}\r\n\r\nfunction genSalt() {\r\n    let salt = \"\";\r\n    let hexs = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', '_', '~', '=', '+'];\r\n    for (let i = 0; i < 16; i++)\r\n        salt += hexs[parseInt(Math.random() * hexs.length)];\r\n    return salt;\r\n}\r\n\r\nclass UserService {\r\n    /**@type {nedb} */\r\n    db;\r\n\r\n    /**\r\n     * \r\n     * @param {nedb} db \r\n     */\r\n    constructor(db) {\r\n        this.db = db;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param {{username: string, password: string, realname: string, phone: string, sex?: number, email?: string}} user \r\n     */\r\n    async register(user) {\r\n        let session = ExpressApp.session;\r\n        if (!user.username || user.username.length > 16)\r\n            return Result.fail(\"username参数格式错误\");\r\n        if (!user.password || user.password.length > 16)\r\n            return Result.fail(\"password参数格式错误\");\r\n        if (!user.realname || user.realname.length > 16)\r\n            return Result.fail(\"realname参数格式错误\");\r\n        if (!user.realname || !/$[1-9][0-9]{10}/g.test(user.phone))\r\n            return Result.fail(\"phone参数格式错误\");\r\n\r\n        let userDb = await this.db.findOne({ table: \"user\", username })\r\n        if (userDb)\r\n            return Result.fail(\"用户名已存在\");\r\n        user.table = \"user\";\r\n        user.salt = genSalt();\r\n        user.password = sha256(user.password + user.salt);\r\n        await this.db.insert(user);\r\n        user.status = true;\r\n        session.user = user;\r\n        return Result.ok();\r\n    }\r\n\r\n    /**\r\n     * 登录\r\n     * @param {string} username \r\n     * @param {string} password \r\n     * @param {string} salt \r\n     * @returns \r\n     */\r\n    async login(username, password, salt) {\r\n        let session = ExpressApp.session;\r\n        if (session.user)\r\n            return Result.fail(\"用户已登录\");\r\n        let user = await this.db.findOne({ table: \"user\", username })\r\n        if (!user)\r\n            return Result.fail(\"用户不存在\");\r\n        let encodedPwd = sha256(password + salt);\r\n\r\n        if (encodedPwd != user.password)\r\n            return Result.fail(\"密码错误\");\r\n        delete user.password;\r\n        delete user.salt;\r\n        session.user = user;\r\n        return Result.ok(user)\r\n    }\r\n\r\n    /**\r\n     * 启用用户\r\n     * @param {string} username \r\n     * @returns \r\n     */\r\n    async enable(username) {\r\n        let session = ExpressApp.session;\r\n        if (!session.user || session.user.username != \"admin\")\r\n            return Result.forbid(\"没有权限\");\r\n        let user = await this.db.findOne({ table: \"user\", username })\r\n        user.status = 1;\r\n        await this.db.insert();\r\n    }\r\n\r\n    /**\r\n     * 禁用用户\r\n     * @param {string} username \r\n     * @returns \r\n     */\r\n     async enable(username) {\r\n        let session = ExpressApp.session;\r\n        if (!session.user || session.user.username != \"admin\")\r\n            return Result.forbid(\"没有权限\");\r\n        let user = await this.db.findOne({ table: \"user\", username })\r\n        user.status = 0;\r\n        await this.db.insert();\r\n    }\r\n}\r\n\r\nexport default UserService;","/*!\n * cookie-parser\n * Copyright(c) 2014 TJ Holowaychuk\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar cookie = require('cookie')\nvar signature = require('cookie-signature')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = cookieParser\nmodule.exports.JSONCookie = JSONCookie\nmodule.exports.JSONCookies = JSONCookies\nmodule.exports.signedCookie = signedCookie\nmodule.exports.signedCookies = signedCookies\n\n/**\n * Parse Cookie header and populate `req.cookies`\n * with an object keyed by the cookie names.\n *\n * @param {string|array} [secret] A string (or array of strings) representing cookie signing secret(s).\n * @param {Object} [options]\n * @return {Function}\n * @public\n */\n\nfunction cookieParser (secret, options) {\n  var secrets = !secret || Array.isArray(secret)\n    ? (secret || [])\n    : [secret]\n\n  return function cookieParser (req, res, next) {\n    if (req.cookies) {\n      return next()\n    }\n\n    var cookies = req.headers.cookie\n\n    req.secret = secrets[0]\n    req.cookies = Object.create(null)\n    req.signedCookies = Object.create(null)\n\n    // no cookies\n    if (!cookies) {\n      return next()\n    }\n\n    req.cookies = cookie.parse(cookies, options)\n\n    // parse signed cookies\n    if (secrets.length !== 0) {\n      req.signedCookies = signedCookies(req.cookies, secrets)\n      req.signedCookies = JSONCookies(req.signedCookies)\n    }\n\n    // parse JSON cookies\n    req.cookies = JSONCookies(req.cookies)\n\n    next()\n  }\n}\n\n/**\n * Parse JSON cookie string.\n *\n * @param {String} str\n * @return {Object} Parsed object or undefined if not json cookie\n * @public\n */\n\nfunction JSONCookie (str) {\n  if (typeof str !== 'string' || str.substr(0, 2) !== 'j:') {\n    return undefined\n  }\n\n  try {\n    return JSON.parse(str.slice(2))\n  } catch (err) {\n    return undefined\n  }\n}\n\n/**\n * Parse JSON cookies.\n *\n * @param {Object} obj\n * @return {Object}\n * @public\n */\n\nfunction JSONCookies (obj) {\n  var cookies = Object.keys(obj)\n  var key\n  var val\n\n  for (var i = 0; i < cookies.length; i++) {\n    key = cookies[i]\n    val = JSONCookie(obj[key])\n\n    if (val) {\n      obj[key] = val\n    }\n  }\n\n  return obj\n}\n\n/**\n * Parse a signed cookie string, return the decoded value.\n *\n * @param {String} str signed cookie string\n * @param {string|array} secret\n * @return {String} decoded value\n * @public\n */\n\nfunction signedCookie (str, secret) {\n  if (typeof str !== 'string') {\n    return undefined\n  }\n\n  if (str.substr(0, 2) !== 's:') {\n    return str\n  }\n\n  var secrets = !secret || Array.isArray(secret)\n    ? (secret || [])\n    : [secret]\n\n  for (var i = 0; i < secrets.length; i++) {\n    var val = signature.unsign(str.slice(2), secrets[i])\n\n    if (val !== false) {\n      return val\n    }\n  }\n\n  return false\n}\n\n/**\n * Parse signed cookies, returning an object containing the decoded key/value\n * pairs, while removing the signed key from obj.\n *\n * @param {Object} obj\n * @param {string|array} secret\n * @return {Object}\n * @public\n */\n\nfunction signedCookies (obj, secret) {\n  var cookies = Object.keys(obj)\n  var dec\n  var key\n  var ret = Object.create(null)\n  var val\n\n  for (var i = 0; i < cookies.length; i++) {\n    key = cookies[i]\n    val = obj[key]\n    dec = signedCookie(val, secret)\n\n    if (val !== dec) {\n      ret[key] = dec\n      delete obj[key]\n    }\n  }\n\n  return ret\n}\n","module.exports = require(\"cookie\");","module.exports = require(\"cookie-signature\");","module.exports = require(\"express\");","module.exports = require(\"nedb-promises\");","module.exports = require(\"crypto\");","module.exports = require(\"process\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import nedb from \"nedb-promises\";\r\nimport ExpressApp from \"./ExpressApp\"\r\nimport UserService from \"./UserService\"\r\n\r\n(async function () {\r\n    let db = nedb.create(\"D:/upload/test.db\");\r\n    await db.load();\r\n\r\n    const app = new ExpressApp();\r\n    let userService = new UserService(db);\r\n    app.get(\"/register\", function ({ request, response, params, body }) {\r\n        return userService.register(body);\r\n    });\r\n\r\n    app.post(\"/login\", function ({ params }) {\r\n        return userService.login(params);\r\n    });\r\n\r\n    await app.listen(80);\r\n})();"],"names":["express","Express","Request","Response","Result","process","cookieParser","makeSessoinId","buf","Buffer","allocUnsafe","writeUInt32LE","pid","writeDoubleLE","Date","getTime","parseInt","Math","random","toString","callback","cb","request","response","sessionId","cookies","JSESSIONID","undefined","session","now","sessions","lastAccessTime","maxInactiveInterval","id","createdTime","cookie","result","ExpressApp","params","body","headers","Promise","err","httpCode","message","stream","status","pipe","send","JSON","stringify","sendStatus","app","constructor","use","get","url","bind","post","put","delete","options","listen","port","resolve","code","ok","toJson","fail","forbid","nedb","crypto","sha256","value","digest","createHash","update","genSalt","salt","hexs","i","length","UserService","db","register","user","username","password","realname","test","phone","userDb","findOne","table","insert","login","encodedPwd","enable","create","load","userService"],"sourceRoot":""}